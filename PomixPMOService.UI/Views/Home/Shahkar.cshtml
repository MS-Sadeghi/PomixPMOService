@{
    ViewData["Title"] = "شاهکار";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="card">
    <form id="shahkarForm">
        <div class="col-xl-6 mb-3">
            <label for="nationalId">کد ملی</label>
            <input type="text" class="form-control" id="nationalId" required pattern="\d{10}" title="کد ملی باید ۱۰ رقم باشد">
        </div>
        <div class="col-xl-6 mb-3">
            <label for="mobileNumber">شماره موبایل</label>
            <input type="text" class="form-control" id="mobileNumber" required pattern="\d{11}" placeholder="09xxxxxxxxx" title="شماره موبایل باید ۱۱ رقم باشد">
        </div>
        <button type="button" class="btn btn-primary" onclick="checkShahkar()">بررسی</button>
    </form>
    <div id="result" class="mt-3"></div>
</div>


<script>
    async function checkShahkar() {
        const nationalId = document.getElementById('nationalId').value;
        const mobileNumber = document.getElementById('mobileNumber').value;
        const resultDiv = document.getElementById('result');

        // اعتبارسنجی
        if (nationalId.length !== 10 || !/^\d+$/.test(nationalId) ||
            mobileNumber.length !== 11 || !/^\d+$/.test(mobileNumber)) {
            resultDiv.innerHTML = '<div class="alert alert-danger">فرمت کد ملی یا شماره موبایل نامعتبر است.</div>';
            return;
        }

        const data = {
            NationalId: nationalId,
            MobileNumber: mobileNumber
        };

        try {
            const response = await fetch('/api/ShahkarService/CheckMobileNationalCode', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data),
                credentials: 'include'
            });

            const result = await response.json();

            if (response.ok) {
                resultDiv.innerHTML = `<div class="alert ${result.IsMatch ? 'alert-success' : 'alert-danger'}">${result.Message}</div>`;
            } else {
                resultDiv.innerHTML = `<div class="alert alert-danger">خطا: ${result.Message || response.statusText} (وضعیت: ${response.status})</div>`;
            }
        } catch (error) {
            resultDiv.innerHTML = `<div class="alert alert-danger">خطای شبکه: ${error.message}</div>`;
            console.error('جزئیات خطا:', error);
        }
    }
</script>