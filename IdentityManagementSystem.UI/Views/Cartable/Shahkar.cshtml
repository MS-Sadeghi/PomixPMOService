@model IdentityManagementSystem.UI.Controllers.CartableFormViewModel
@{
    ViewData["Title"] = "شاهکار";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="card">
    <div class="card-header">
        <h4 class="card-title">احراز هویت متقاضی</h4>
    </div>
    <div class="card-body">
        <form id="shahkarForm">
            <div class="form-group">
                <label for="nationalCode" class="form-label">کد ملی</label>
                <input type="text" class="form-control" id="nationalCode" name="NationalCode" placeholder="کد ملی 10 رقمی" maxlength="10">
            </div>
            <div class="form-group">
                <label for="mobileNumber" class="form-label">شماره همراه</label>
                <input type="text" class="form-control" id="mobileNumber" name="MobileNumber" placeholder="09xxxxxxxxx" maxlength="11">
            </div>
            <button type="submit" class="btn btn-primary mt-4 mb-0">بررسی</button>
        </form>
        <div id="resultMessage" class="mt-3"></div>
    </div>
</div>

@section Scripts {
        <script>
            $(document).ready(function () {
                $("#shahkarForm").submit(function (e) {
                    e.preventDefault();

                    var nationalCode = $("#nationalCode").val();
                    var mobileNumber = $("#mobileNumber").val();

                    if (!/^\d{10}$/.test(nationalCode)) {
                        $("#resultMessage").html('<div class="alert alert-danger">کد ملی باید 10 رقم باشد.</div>');
                        return;
                    }
                    if (!/^09\d{9}$/.test(mobileNumber)) {
                        $("#resultMessage").html('<div class="alert alert-danger">شماره موبایل باید 11 رقم و با 09 شروع شود.</div>');
                        return;
                    }

                    $.ajax({
                        url: '@Url.Action("ValidateShahkar", "Cartable")',
                        type: 'POST',
                        data: {
                            NationalCode: nationalCode,
                            MobileNumber: mobileNumber,
                            '__RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                        },
                        success: function (response) {
                            if (response.success) {
                                $("#resultMessage").html('<div class="alert alert-success">' + response.message + '</div>');
                            } else {
                                $("#resultMessage").html('<div class="alert alert-danger">' + response.message + '</div>');
                            }
                        },
                        error: function (xhr, status, error) {
                            $("#resultMessage").html('<div class="alert alert-danger">خطا در ارتباط با سرور: ' + error + '</div>');
                        }
                    });
                });
            });
        </script>
}