@{
    ViewData["Title"] = "شاهکار";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="card">
    <form id="shahkarForm">
        <div class="col-xl-6 mb-3">
            <label for="nationalId">کد ملی</label>
            <input type="text" class="form-control" id="nationalId" required pattern="\d{10}" title="کد ملی باید ۱۰ رقم باشد">
        </div>
        <div class="col-xl-6 mb-3">
            <label for="mobileNumber">شماره موبایل</label>
            <input type="text" class="form-control" id="mobileNumber" required pattern="\d{11}" placeholder="09xxxxxxxxx" title="شماره موبایل باید ۱۱ رقم باشد">
        </div>
        <button type="button" class="btn btn-primary" onclick="checkShahkar()">بررسی</button>
    </form>

    <div id="result" class="mt-3"></div> <!-- نتیجه اینجا نمایش داده می‌شه -->
</div>

<script>
    function checkShahkar() {
        var nationalId = document.getElementById('nationalId').value;
        var mobileNumber = document.getElementById('mobileNumber').value;

        // اعتبارسنجی ساده سمت کلاینت
        if (nationalId.length !== 10 || !/^\d+$/.test(nationalId) ||
            mobileNumber.length !== 11 || !/^\d+$/.test(mobileNumber)) {
            alert('فرمت کد ملی یا شماره موبایل نامعتبر است.');
            return;
        }

        var data = {
            NationalId: nationalId,
            MobileNumber: mobileNumber
        };

        fetch('https://localhost:5001/api/ShahkarService/CheckMobileNationalCode', {  // URL API رو جایگزین کن
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer YOUR_TOKEN_HERE'  // اگر احراز هویت داری (مثل JWT)، توکن رو اضافه کن
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('خطا: ' + response.statusText);
            }
            return response.json();
        })
        .then(result => {
            var resultDiv = document.getElementById('result');
            if (result.IsMatch) {
                resultDiv.innerHTML = '<div class="alert alert-success">همخوانی دارند: ' + result.Message + '</div>';
            } else {
                resultDiv.innerHTML = '<div class="alert alert-danger">همخوانی ندارند: ' + result.Message + '</div>';
            }
        })
        .catch(error => {
            document.getElementById('result').innerHTML = '<div class="alert alert-danger">' + error.message + '</div>';
        });
    }
</script>